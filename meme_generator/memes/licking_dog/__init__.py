from pathlib import Path
from typing import List

from PIL.Image import Image as IMG
from pil_utils import BuildImage

from meme_generator import add_meme
from meme_generator.utils import save_gif

img_dir = Path(__file__).parent / "images"


def licking_dog(images: List[BuildImage], texts, args):
    img = images[0].convert("RGBA").square()
    frames: List[IMG] = []
    params1 = [
        [(0, 0), (129, 3), (155, 123), (12, 142)],
        [(0, 29), (128, 0), (149, 118), (30, 147)],
        [(0, 37), (136, 1), (160, 97), (16, 152)],
        [(0, 58), (169, 1), (194, 92), (24, 170)],
        [(0, 114), (166, 1), (168, 98), (41, 205)],
        [(-1, 112), (170, 0), (168, 113), (44, 195)],
        [(0, 73), (148, 0), (172, 81), (45, 170)],
        [(0, 62), (159, 1), (177, 81), (47, 155)],
        [(1, 45), (126, 1), (158, 81), (29, 145)],
        [(0, 63), (161, 1), (190, 88), (42, 153)],
        [(0, 57), (152, 0), (195, 82), (40, 149)],
        [(0, 41), (141, 0), (170, 90), (27, 138)],
        [(0, 1), (132, 0), (131, 112), (1, 114)],
        [(0, 1), (132, 0), (131, 112), (1, 114)],
        [(1, 7), (138, 0), (141, 126), (4, 131)],
        [(0, 0), (142, 0), (142, 131), (0, 131)],
        [(0, 0), (147, 0), (147, 115), (0, 115)],
        [(0, 0), (158, 0), (158, 102), (0, 102)],
        [(0, 0), (158, 0), (158, 107), (0, 107)],
        [(0, 0), (158, 0), (158, 103), (0, 101)],
        [(0, 0), (153, 0), (153, 122), (0, 120)],
        [(61, 0), (194, 15), (143, 146), (0, 133)],
        [(88, 1), (173, 17), (123, 182), (0, 131)],
        [(118, 3), (201, 48), (111, 220), (1, 168)],
    ]
    locs = [
        (21, 75),
        (18, 73),
        (22, 78),
        (22, 58),
        (43, 23),
        (39, 24),
        (31, 54),
        (24, 62),
        (31, 75),
        (18, 61),
        (20, 66),
        (16, 77),
        (28, 105),
        (21, 107),
        (11, 113),
        (10, 114),
        (5, 121),
        (0, 119),
        (0, 116),
        (0, 119),
        (2, 101),
        (-18, 85),
        (0, 66),
        (0, 29),
    ]
    for i in range(24):
        frame = BuildImage.open(img_dir / f"{i}.png")
        frame.paste(img.perspective(params1[i]), locs[i], below=True)
        frames.append(frame.image)

    return save_gif(frames, 0.05)


add_meme("licking_dog", licking_dog, min_images=1, max_images=1, keywords=["舔狗", "沸羊羊"])
